# Session management for Tor-friendly rate limiting
# This snippet sets a session ID cookie for clients without one

# Set session ID cookie if client doesn't have one
# Uses nginx $request_id which provides a unique value per request
# SameSite=Lax for CSRF protection while allowing normal navigation
# HttpOnly prevents JavaScript access for security
# Max-Age=86400 means cookie expires after 24 hours
set $session_cookie "";
if ($cookie_session_id = "") {
    set $session_cookie "session_id=$request_id; Path=/; HttpOnly; SameSite=Lax; Max-Age=86400";
}
# Only set cookie if client doesn't have one (avoid setting on every request)
add_header Set-Cookie $session_cookie;
