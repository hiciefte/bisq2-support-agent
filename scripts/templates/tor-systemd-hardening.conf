# Tor systemd hardening override
# Place in: /etc/systemd/system/tor.service.d/hardening.conf
# Apply with: systemctl daemon-reload && systemctl restart tor

[Service]
# Process isolation
PrivateTmp=yes
PrivateDevices=yes
ProtectHome=yes
ProtectSystem=strict

# File system
ReadWritePaths=/var/lib/tor
ReadOnlyPaths=/etc/tor

# Network
PrivateNetwork=no
RestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX

# Capabilities
NoNewPrivileges=yes
CapabilityBoundingSet=CAP_SETUID CAP_SETGID CAP_NET_BIND_SERVICE
AmbientCapabilities=CAP_NET_BIND_SERVICE

# System calls
SystemCallFilter=@system-service
SystemCallFilter=~@privileged @resources
SystemCallErrorNumber=EPERM

# Memory
MemoryDenyWriteExecute=yes
RestrictRealtime=yes
LockPersonality=yes

# Other
RestrictNamespaces=yes
UMask=0077
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectControlGroups=yes
ProtectClock=yes
ProtectKernelLogs=yes
